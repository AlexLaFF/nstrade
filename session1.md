In this session, we designed and implemented a minimal, extensible Python backtesting framework for trading strategies, with a focus on long-only, full-portfolio, hourly BTC/USD data. The system was structured around a base `Strategy` class, a backtest runner, and a metrics module, all intended to be reusable and easy to extend. The user wanted to support custom strategies via inheritance, and to be able to compare strategies like Buy & Hold and SMA Crossover in a Jupyter notebook, with a full suite of performance metrics including Sharpe ratio, total/annualized return, drawdowns, and trade statistics.

We began by outlining the necessary files and interfaces, then implemented the base `Strategy` class, a comprehensive `metrics.py` with both single-value and time-series metrics (including rolling Sharpe and drawdown series), and a `backtest.py` runner that loaded CSV data, ran the strategy, and returned all results in a dictionary. The user provided constraints such as no shorting, no bet sizing, and only buy/sell/hold signals, which were enforced in the backtest logic.

As we moved to the notebook, we encountered and resolved several issues. First, we ensured the data cleaning step was consistent, always extracting and renaming the correct columns and casting timestamps. We then addressed a critical bug in the backtest logic: the original equity curve update was compounding returns incorrectly, leading to astronomically large and unrealistic results. This was fixed by tracking the number of coins held and using mark-to-market valuation at each bar, ensuring the equity curve accurately reflected the portfolio's value.

We also encountered and fixed issues related to index handling, especially when plotting trades and metrics. Negative or out-of-bounds indices in pandas Series and DataFrames caused errors, which were resolved by using `.iloc` for positional indexing and by filtering trade indices to ensure they were within valid bounds. This made the plotting code robust and prevented runtime errors.

Finally, we produced polished, multi-panel matplotlib visualizations for each strategy, showing price and volume, equity curve, drawdowns, rolling Sharpe, and buy/sell points. The session concluded with a robust, extensible backtesting and analysis workflow, ready for further strategy development and research.
